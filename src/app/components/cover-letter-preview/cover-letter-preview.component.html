<div class="preview-shell">
  <div class="preview-header">
    <div>
      <h3>Cover Letter Preview</h3>
      <div class="meta">
        <span *ngIf="companyName" class="meta-company">{{ companyName }}</span>
        <span *ngIf="hiringManager" class="meta-manager"> • Attn: {{ hiringManager }}</span>
      </div>
    </div>
    <div class="controls">
        <button class="btn small" (click)="copy()">Copy</button>
        <button class="btn small" (click)="downloadAsTxt()">Download TXT</button>
        <button class="btn small" (click)="print()">Print</button>
        <button class="btn ghost" (click)="closeClick()">Close</button>
    </div>
  </div>

  <div class="preview-body">
      <app-loader [visible]="loading || pdfLoading" [message]="loadingMessage || 'Generating cover letter...'" ></app-loader>
      <pre class="cover-text" *ngIf="!pdfUrl && !pdfUrlInput">{{ coverLetter || 'No cover letter generated yet.' }}</pre>
      <div *ngIf="pdfLoading" class="pdf-loading">Loading PDF…</div>

      <div class="pdf-frame" *ngIf="useCustomRenderer">
        <div class="pdf-toolbar">
          <button class="btn small" (click)="zoomOut()">-</button>
          <button class="btn small" (click)="zoomIn()">+</button>
          <button class="btn small" (click)="downloadPdf()">Download</button>
          <button class="btn small" (click)="printPdf()">Print</button>
        </div>
        <div id="pdfjs-render-container" class="pdf-render-container"></div>
      </div>

      <!-- fallback: sanitized iframe (default browser/pdf viewer) -->
      <div class="pdf-frame" *ngIf="!useCustomRenderer && safePdfUrl">
        <iframe [src]="safePdfUrl" frameborder="0"></iframe>
      </div>
  </div>

  <div class="preview-footer">
    <small class="hint">Tip: Use "Download" to save a copy or "Copy" to paste into an application.</small>
  </div>
</div>
